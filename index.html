<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smartphone Video Masterclass</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Custom Scrollbar Styles */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(17, 24, 39, 0.2);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* --- NEW: Organic Blob Background Animation --- */
        @keyframes float1 {
            0% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0, 0) scale(1); }
        }
        @keyframes float2 {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-40px, 30px) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes float3 {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, 40px) scale(1.2); }
            100% { transform: translate(0, 0) scale(1); }
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5; /* Transparenz für den "Dark Mode" Look */
            z-index: 0;
        }

        /* Türkis/Blau Töne, aber dunkel gehalten */
        .blob-1 {
            top: -10%;
            left: -10%;
            width: 50vw;
            height: 50vw;
            background: #0e7490; /* Cyan-700 */
            animation: float1 20s infinite ease-in-out alternate;
            opacity: 0.4;
        }
        
        .blob-2 {
            bottom: -20%;
            right: -10%;
            width: 60vw;
            height: 60vw;
            background: #1e3a8a; /* Blue-900 */
            animation: float2 25s infinite ease-in-out alternate;
            opacity: 0.5;
        }

        .blob-3 {
            top: 40%;
            left: 40%;
            width: 40vw;
            height: 40vw;
            background: #0f766e; /* Teal-700 */
            animation: float3 22s infinite ease-in-out alternate;
            opacity: 0.3;
        }
    </style>
</head>
<body class="bg-[#020617] text-gray-100 font-sans overflow-hidden selection:bg-indigo-500 selection:text-white h-screen flex flex-col relative">

    <!-- Background Layer (Bubbles) -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <!-- App Container (mit z-index, damit er über dem Hintergrund liegt) -->
    <div id="app" class="relative z-10 h-full w-full bg-black/20 backdrop-blur-[10px]"></div>

    <script>
        // --- DATEN ---
        const courseData = [
            {
                id: 'm1',
                title: 'Modul 1: Das Fundament (Mindset & Planung)',
                description: 'Bevor die Kamera läuft, muss klar sein, wohin die Reise geht. Hier holt ihr die Teilnehmer emotional ab.',
                iconName: 'layout',
                iconColor: 'text-indigo-400',
                lessons: [
                    { id: 'l1-1', title: 'Warum Video? Die Macht von Bewegtbild', duration: '05:30', videoId: 'why-video', description: 'Sichtbarkeit und Vertrauen durch Videos aufbauen.' },
                    { id: 'l1-2', title: 'Die Angst vor der Kamera besiegen', duration: '08:45', videoId: 'fear-camera', description: 'Tipps gegen Lampenfieber und für ein natürliches Auftreten.' },
                    { id: 'l1-3', title: 'Zielgruppe & Botschaft', duration: '06:15', videoId: 'target-audience', description: 'Für wen ist das Video und was ist die Kernaussage?' },
                    { id: 'l1-4', title: 'Skripting-Basics', duration: '10:00', videoId: 'scripting', description: 'Teleprompter vs. Stichpunkte. Wie man frei spricht, ohne den Faden zu verlieren.' },
                ]
            },
            {
                id: 'm2',
                title: 'Modul 2: Das Equipment (Was man wirklich braucht)',
                description: 'Entmystifizierung der Technik. Der Fokus sollte darauf liegen, dass das Smartphone meistens ausreicht.',
                iconName: 'smartphone',
                iconColor: 'text-purple-400',
                lessons: [
                    { id: 'l2-1', title: 'Kamera vs. Smartphone', duration: '07:20', videoId: 'cam-vs-phone', description: 'Warum das Handy für 90 % der Anwendungsfälle reicht.' },
                    { id: 'l2-2', title: 'Stative & Halterungen', duration: '09:10', videoId: 'tripods', description: 'Wackelfreie Bilder garantieren (Tipps zu Gimbals und Ringlicht-Stativen).' },
                    { id: 'l2-3', title: 'Die unsichtbare Magie – Audio', duration: '12:00', videoId: 'audio-magic', description: 'Warum guter Ton wichtiger ist als ein perfektes Bild (Ansteck- & Richtmikrofone).' },
                ]
            },
            {
                id: 'm3',
                title: 'Modul 3: Das perfekte Bild (Kameraführung & Licht)',
                description: 'Hier kommt der Kernwunsch deines Auftraggebers! Visuell und praktisch erklärt.',
                iconName: 'zap',
                iconColor: 'text-yellow-400',
                lessons: [
                    { id: 'l3-1', title: 'Kamera richtig halten', duration: '06:50', videoId: 'holding-cam', description: 'Hochformat (TikTok/Reels) vs. Querformat (YouTube). Die richtige Höhe (Augenhöhe!).' },
                    { id: 'l3-2', title: 'Bildkomposition: Drittel-Regel', duration: '11:30', videoId: 'composition', description: 'Rule of Thirds verständlich erklärt. Headroom beachten.' },
                    { id: 'l3-3', title: 'Lichtverhältnisse meistern', duration: '14:20', videoId: 'lighting-mastery', description: 'Natürliches Licht nutzen und Gegenlicht vermeiden.' },
                    { id: 'l3-4', title: 'Günstige Kunstlicht-Setups', duration: '08:15', videoId: 'artificial-light', description: 'Das einfache 2- oder 3-Punkt-Licht Setup.' },
                    { id: 'l3-5', title: 'Hintergrund-Gestaltung', duration: '05:45', videoId: 'background', description: 'Was der Raum aussagt: Tiefe schaffen, Unordnung vermeiden.' },
                ]
            },
            {
                id: 'm4',
                title: 'Modul 4: Action! Der eigentliche Dreh',
                description: 'Tipps für den Workflow, damit der Dreh nicht im Chaos endet.',
                iconName: 'film',
                iconColor: 'text-red-400',
                lessons: [
                    { id: 'l4-1', title: 'Der Kamera-Check', duration: '04:00', videoId: 'pre-check', description: 'Linse putzen, Flugmodus an, Akku checken, Speicherplatz prüfen.' },
                    { id: 'l4-2', title: 'Klappe und Action', duration: '07:30', videoId: 'action-tipps', description: 'Pausen nutzen, um das Schneiden zu erleichtern. Fehler einfach weglächeln.' },
                    { id: 'l4-3', title: 'B-Roll Material (Optional)', duration: '06:10', videoId: 'b-roll', description: 'Wie man Zwischensequenzen dreht, um das Video spannender zu machen.' },
                ]
            },
            {
                id: 'm5',
                title: 'Modul 5: Postproduktion (Schnitt für Anfänger)',
                description: 'Niemand will Stunden am PC verbringen. Die einfachsten Wege zum fertigen Video.',
                iconName: 'scissors',
                iconColor: 'text-blue-400',
                lessons: [
                    { id: 'l5-1', title: 'Die besten Anfänger-Tools', duration: '08:00', videoId: 'tools', description: 'Vorstellung von Apps wie CapCut, InShot oder einfachen Desktop-Programmen.' },
                    { id: 'l5-2', title: 'Der Rohschnitt', duration: '10:30', videoId: 'rough-cut', description: 'Versprecher und „Ähms“ herausschneiden.' },
                    { id: 'l5-3', title: 'Formatierung & Untertitel', duration: '09:15', videoId: 'subs', description: 'Untertitel automatisch generieren lassen (heute ein Muss!).' },
                    { id: 'l5-4', title: 'Musik & Effekte', duration: '07:45', videoId: 'music-sfx', description: 'Wo man lizenzfreie Musik herbekommt und wie man sie dezent einsetzt.' },
                ]
            },
            {
                id: 'm6',
                title: 'Modul 6: Raus in die Welt (Export & Veröffentlichung)',
                description: 'Das Video ist fertig, was nun? Die letzten Schritte zum Erfolg.',
                iconName: 'share-2',
                iconColor: 'text-green-400',
                lessons: [
                    { id: 'l6-1', title: 'Die richtigen Export-Einstellungen', duration: '05:20', videoId: 'export', description: 'Welche Auflösung (1080p vs. 4k) macht wo Sinn?' },
                    { id: 'l6-2', title: 'Thumbnail & Beschreibung', duration: '08:50', videoId: 'publish', description: 'Wie man Leute dazu bringt, überhaupt auf das Video zu klicken.' },
                ]
            }
        ];

        // --- STATE MANAGEMENT ---
        const state = {
            view: 'dashboard', // 'dashboard' | 'module'
            activeModuleId: null,
            activeLessonId: 'l1-1',
            completedLessons: new Set(),
            isSidebarOpen: false,
            dashboardSearch: ''
        };

        const allLessons = courseData.flatMap(m => m.lessons);

        // --- HELPER FUNCTIONS ---
        function getGlobalProgress() {
            return Math.round((state.completedLessons.size / allLessons.length) * 100);
        }

        function getModuleProgress(module) {
            const moduleLessonIds = module.lessons.map(l => l.id);
            const completedCount = moduleLessonIds.filter(id => state.completedLessons.has(id)).length;
            return Math.round((completedCount / moduleLessonIds.length) * 100);
        }

        function getActiveLesson() {
            return allLessons.find(l => l.id === state.activeLessonId);
        }

        function getActiveModule() {
            return courseData.find(m => m.id === state.activeModuleId);
        }

        function getActiveLessonIndex() {
            return allLessons.findIndex(l => l.id === state.activeLessonId);
        }

        // --- RENDER LOGIC ---

        function renderProgressBar(progress, className = "") {
            return `
                <div class="w-full bg-gray-800 rounded-full h-2.5 ${className}">
                    <div class="bg-indigo-500 h-2.5 rounded-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(99,102,241,0.5)]" style="width: ${progress}%"></div>
                </div>
            `;
        }

        function renderVideoPlayer(lesson) {
            return `
                <div class="aspect-video bg-black rounded-xl overflow-hidden shadow-2xl relative group border border-gray-800/50 backdrop-blur-sm">
                    <div class="absolute inset-0 flex items-center justify-center bg-black/40 group-hover:bg-black/30 transition-all cursor-pointer">
                        <div class="w-20 h-20 bg-indigo-600/90 rounded-full flex items-center justify-center pl-2 shadow-lg hover:scale-110 transition-transform backdrop-blur-md">
                            <i data-lucide="play" class="text-white w-10 h-10 fill-current"></i>
                        </div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black via-black/80 to-transparent pointer-events-none">
                        <h2 class="text-white text-xl font-bold">${lesson.title}</h2>
                        <p class="text-gray-300 text-sm">Videovorschau für ID: ${lesson.videoId}</p>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const filteredModules = courseData.filter(m => 
                m.title.toLowerCase().includes(state.dashboardSearch.toLowerCase()) ||
                m.description.toLowerCase().includes(state.dashboardSearch.toLowerCase())
            );

            let modulesHTML = filteredModules.map(module => {
                const progress = getModuleProgress(module);
                const progressBadge = progress > 0 
                    ? `<div class="text-xs font-semibold bg-indigo-900/50 text-indigo-300 px-3 py-1 rounded-full border border-indigo-500/20 shadow-sm backdrop-blur-sm">${progress}%</div>`
                    : '';
                
                return `
                    <button onclick="handleModuleClick('${module.id}')" class="bg-gray-900/40 hover:bg-gray-800/50 border border-gray-800/50 hover:border-gray-700/50 rounded-2xl p-6 text-left transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl hover:shadow-indigo-500/10 group flex flex-col h-full w-full backdrop-blur-sm">
                        <div class="flex justify-between items-start mb-6 w-full">
                            <div class="p-3 bg-gray-950/60 rounded-xl border border-gray-800 group-hover:border-indigo-500/30 transition-colors shadow-lg">
                                <i data-lucide="${module.iconName}" class="w-8 h-8 ${module.iconColor}"></i>
                            </div>
                            ${progressBadge}
                        </div>
                        <h3 class="text-xl font-bold text-gray-100 mb-3 group-hover:text-indigo-400 transition-colors">${module.title}</h3>
                        <p class="text-gray-400 text-sm leading-relaxed mb-6 flex-1">${module.description}</p>
                        <div class="pt-6 border-t border-gray-800/50 flex items-center justify-between w-full mt-auto">
                            <div class="flex items-center gap-2 text-xs text-gray-500 font-medium">
                                <i data-lucide="clock" class="w-3.5 h-3.5"></i>
                                ${module.lessons.length} Lektionen
                            </div>
                            <div class="flex items-center gap-1 text-sm font-semibold text-white group-hover:translate-x-1 transition-transform">
                                Starten <i data-lucide="chevron-right" class="w-4 h-4"></i>
                            </div>
                        </div>
                    </button>
                `;
            }).join('');

            return `
                <div class="min-h-screen text-gray-100 pb-20 overflow-y-auto custom-scrollbar h-full">
                    <!-- Header -->
                    <header class="bg-gray-950/60 backdrop-blur-md border-b border-gray-800/50 sticky top-0 z-30">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20">
                                    <i data-lucide="film" class="text-white w-6 h-6"></i>
                                </div>
                                <h1 class="text-xl font-bold tracking-tight">Smartphone Masterclass</h1>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="hidden md:flex flex-col items-end mr-4">
                                    <span class="text-xs text-gray-400 mb-1">Gesamtfortschritt</span>
                                    <div class="w-32">${renderProgressBar(getGlobalProgress(), "mb-0")}</div>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center shadow-lg">
                                    <span class="font-bold text-sm">JJ</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Hero / Welcome -->
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        <div class="text-center max-w-2xl mx-auto mb-16">
                            <h2 class="text-3xl md:text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400 drop-shadow-sm">Deine Lernreise</h2>
                            <p class="text-gray-400 text-lg mb-8 drop-shadow-md">Wähle ein Modul aus, um zu starten. Du kannst jederzeit zwischen den Themen springen.</p>
                            <div class="relative max-w-md mx-auto">
                                <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-gray-500"></i>
                                <input type="text" placeholder="Was möchtest du heute lernen?" value="${state.dashboardSearch}" 
                                    oninput="handleSearchInput(this.value)"
                                    class="w-full bg-gray-900/60 border border-gray-700/50 text-gray-200 rounded-full pl-12 pr-6 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all shadow-lg backdrop-blur-md placeholder-gray-500">
                            </div>
                        </div>

                        <!-- Module Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${modulesHTML}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLessonView() {
            const activeModule = getActiveModule();
            const activeLesson = getActiveLesson();
            const activeLessonIndex = getActiveLessonIndex();
            const currentModuleLessons = activeModule ? activeModule.lessons : [];
            const isCompleted = state.completedLessons.has(activeLesson.id);

            // Sidebar Lessons HTML
            const sidebarLessonsHTML = currentModuleLessons.map(lesson => {
                const isActive = state.activeLessonId === lesson.id;
                const isDone = state.completedLessons.has(lesson.id);
                
                let icon;
                if (isDone) {
                    icon = `<i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>`;
                } else if (isActive) {
                    icon = `<div class="w-5 h-5 rounded-full border-2 border-indigo-400 flex items-center justify-center"><div class="w-2 h-2 bg-indigo-400 rounded-full animate-pulse"></div></div>`;
                } else {
                    icon = `<i data-lucide="circle" class="w-5 h-5 text-gray-600 group-hover:text-gray-500"></i>`;
                }

                return `
                    <button onclick="handleLessonClick('${lesson.id}')" class="w-full flex items-start gap-3 p-3 rounded-xl text-left transition-all duration-200 group border ${isActive ? 'bg-indigo-900/30 border-indigo-500/40 shadow-sm backdrop-blur-sm' : 'hover:bg-gray-800/40 border-transparent hover:border-gray-800/50'}">
                        <div class="mt-0.5 flex-shrink-0">${icon}</div>
                        <div class="min-w-0">
                            <div class="text-sm font-medium truncate ${isActive ? 'text-indigo-200' : 'text-gray-300'}">${lesson.title}</div>
                            <div class="flex items-center gap-1.5 text-xs text-gray-500 mt-1.5">
                                <i data-lucide="clock" class="w-3 h-3"></i> ${lesson.duration}
                            </div>
                        </div>
                    </button>
                `;
            }).join('');

            // Complete Button HTML
            const completeBtnClass = isCompleted 
                ? 'bg-green-500/90 text-white shadow-lg shadow-green-900/30 backdrop-blur-sm' 
                : 'bg-white/95 text-gray-900 hover:bg-white shadow-lg shadow-white/10 backdrop-blur-sm';
            
            const completeBtnContent = isCompleted
                ? `<i data-lucide="check-circle" class="w-5 h-5"></i> Lektion abgeschlossen`
                : `<div class="w-5 h-5 rounded-full border-2 border-gray-400"></div> Als erledigt markieren`;

            // Next/Prev Buttons
            const prevDisabled = activeLessonIndex === 0 ? 'disabled opacity-30 cursor-not-allowed' : '';
            const nextDisabled = activeLessonIndex === allLessons.length - 1 ? 'disabled opacity-30 cursor-not-allowed' : '';
            
            const prevTitle = activeLessonIndex > 0 ? allLessons[activeLessonIndex - 1].title : 'Start';
            const nextTitle = activeLessonIndex < allLessons.length - 1 ? allLessons[activeLessonIndex + 1].title : 'Ende';

            // Sidebar Overlay for Mobile
            const overlayHTML = state.isSidebarOpen 
                ? `<div class="fixed inset-0 bg-black/80 z-40 lg:hidden backdrop-blur-sm" onclick="toggleSidebar()"></div>` 
                : '';

            const sidebarTransform = state.isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0';

            return `
                <div class="flex h-screen text-gray-100 font-sans overflow-hidden w-full relative">
                    ${overlayHTML}

                    <!-- Sidebar -->
                    <aside class="fixed lg:static inset-y-0 left-0 z-50 w-80 bg-gray-950/80 backdrop-blur-xl border-r border-gray-800/50 flex flex-col transition-transform duration-300 ease-in-out ${sidebarTransform} shadow-2xl">
                        <div class="p-4 border-b border-gray-800/50">
                            <button onclick="handleBackToDashboard()" class="flex items-center gap-2 text-gray-400 hover:text-white mb-6 text-sm font-medium transition-colors hover:bg-gray-800/50 p-2 rounded-lg w-full">
                                <i data-lucide="arrow-left" class="w-4 h-4"></i> Zurück zur Übersicht
                            </button>
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 bg-gray-900 rounded-lg flex items-center justify-center border border-gray-800 ${activeModule.iconColor} shadow-inner">
                                    <i data-lucide="${activeModule.iconName}" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-500 uppercase tracking-wider font-bold">Aktuelles Modul</div>
                                    <h2 class="font-bold text-sm leading-tight text-gray-200 line-clamp-1">${activeModule.title}</h2>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 font-medium mb-2">
                                <span>Modul Fortschritt</span>
                                <span>${getModuleProgress(activeModule)}%</span>
                            </div>
                            ${renderProgressBar(getModuleProgress(activeModule))}
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2">
                            ${sidebarLessonsHTML}
                        </div>
                        <div class="p-4 border-t border-gray-800/50 bg-gray-950/50">
                            <div class="text-xs text-gray-500 text-center">Gesamtkurs: ${getGlobalProgress()}% fertig</div>
                        </div>
                    </aside>

                    <!-- Main Content -->
                    <main class="flex-1 flex flex-col h-full overflow-hidden relative">
                        <!-- Mobile Header -->
                        <header class="h-14 border-b border-gray-800/50 flex items-center justify-between px-4 lg:hidden bg-gray-950/80 backdrop-blur-md shrink-0">
                            <div class="flex items-center gap-3">
                                <button onclick="handleBackToDashboard()" class="p-1 text-gray-400">
                                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                </button>
                                <span class="font-semibold text-sm text-gray-200 truncate max-w-[150px]">${activeModule.title}</span>
                            </div>
                            <button onclick="toggleSidebar()" class="p-2 text-indigo-400 bg-indigo-500/10 rounded-lg">
                                <i data-lucide="menu" class="w-5 h-5"></i>
                            </button>
                        </header>

                        <!-- Content Scroll Area -->
                        <div class="flex-1 overflow-y-auto p-4 lg:p-8 custom-scrollbar">
                            <div class="max-w-5xl mx-auto pb-20">
                                <div class="hidden lg:flex items-center gap-2 text-sm text-gray-500 mb-6 font-medium">
                                    <span onclick="handleBackToDashboard()" class="hover:text-white cursor-pointer transition-colors drop-shadow-md">Dashboard</span>
                                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                    <span class="text-indigo-400 drop-shadow-md">${activeModule.title}</span>
                                </div>

                                <div class="mb-8">
                                    ${renderVideoPlayer(activeLesson)}
                                </div>

                                <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-8 mb-10 pb-8 border-b border-gray-800/50">
                                    <div class="flex-1 space-y-4">
                                        <div class="flex items-center gap-3">
                                            <span class="px-2.5 py-0.5 rounded text-xs font-bold bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 backdrop-blur-sm">LEKTION ${activeLessonIndex + 1}</span>
                                        </div>
                                        <h1 class="text-2xl md:text-3xl font-bold text-white drop-shadow-lg">${activeLesson.title}</h1>
                                        <p class="text-gray-400 leading-relaxed text-lg max-w-2xl drop-shadow-md">${activeLesson.description}</p>
                                        <div class="flex gap-3 pt-2">
                                            <button class="text-sm text-gray-400 hover:text-white underline underline-offset-4 decoration-gray-700">Materialien herunterladen</button>
                                        </div>
                                    </div>
                                    <div class="flex-shrink-0 w-full lg:w-auto">
                                        <button onclick="toggleLessonComplete('${activeLesson.id}')" class="w-full lg:w-64 py-4 px-6 rounded-xl font-bold flex items-center justify-center gap-3 transition-all transform active:scale-95 ${completeBtnClass}">
                                            ${completeBtnContent}
                                        </button>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="handlePrev()" ${prevDisabled} class="flex flex-col items-start gap-1 p-4 rounded-xl border border-gray-800/50 bg-gray-900/40 hover:bg-gray-800/60 hover:border-gray-700/50 backdrop-blur-sm transition-all group text-left ${prevDisabled ? '' : 'hover:shadow-lg'}">
                                        <span class="text-xs text-gray-500 font-bold uppercase flex items-center gap-1 group-hover:text-indigo-400 transition-colors">
                                            <i data-lucide="chevron-left" class="w-3 h-3"></i> Vorherige
                                        </span>
                                        <span class="font-semibold text-gray-300 group-hover:text-white truncate w-full">${prevTitle}</span>
                                    </button>
                                    <button onclick="handleNext()" ${nextDisabled} class="flex flex-col items-end gap-1 p-4 rounded-xl border border-gray-800/50 bg-gray-900/40 hover:bg-gray-800/60 hover:border-gray-700/50 backdrop-blur-sm transition-all group text-right ${nextDisabled ? '' : 'hover:shadow-lg'}">
                                        <span class="text-xs text-gray-500 font-bold uppercase flex items-center gap-1 group-hover:text-indigo-400 transition-colors">
                                            Nächste <i data-lucide="chevron-right" class="w-3 h-3"></i>
                                        </span>
                                        <span class="font-semibold text-gray-300 group-hover:text-white truncate w-full">${nextTitle}</span>
                                    </button>
                                </div>

                                <div class="mt-16">
                                    <div class="flex items-center gap-2 mb-6">
                                        <h3 class="text-xl font-bold drop-shadow-md">Diskussion</h3>
                                        <span class="bg-gray-800/80 text-xs px-2 py-0.5 rounded-full text-gray-400 backdrop-blur-sm">12</span>
                                    </div>
                                    <div class="bg-gray-950/40 rounded-2xl p-6 border border-gray-800/50 flex gap-4 backdrop-blur-md shadow-xl">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-bold text-white shadow-lg shrink-0">JJ</div>
                                        <div class="flex-1">
                                            <textarea placeholder="Hast du Fragen zu dieser Lektion?" class="w-full bg-transparent border-0 text-gray-200 placeholder-gray-500 focus:ring-0 outline-none resize-none h-20 text-lg"></textarea>
                                            <div class="flex justify-between items-center mt-2 border-t border-gray-800/50 pt-4">
                                                <div class="text-xs text-gray-500">Markdown unterstützt</div>
                                                <button class="text-sm bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-2 rounded-lg font-bold transition-colors shadow-lg shadow-indigo-500/20">Senden</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        // --- CORE ACTIONS ---

        function renderApp() {
            const app = document.getElementById('app');
            if (state.view === 'dashboard') {
                app.innerHTML = renderDashboard();
            } else {
                app.innerHTML = renderLessonView();
            }
            // Initialize Icons
            lucide.createIcons();
        }

        // Global Event Handlers
        window.handleModuleClick = (moduleId) => {
            state.activeModuleId = moduleId;
            const module = courseData.find(m => m.id === moduleId);
            if(module && module.lessons.length > 0) {
                 // Try to find the first unfinished lesson, or default to the first one
                 state.activeLessonId = module.lessons[0].id;
            }
            state.view = 'module';
            window.scrollTo(0,0);
            renderApp();
        };

        window.handleBackToDashboard = () => {
            state.view = 'dashboard';
            state.isSidebarOpen = false;
            renderApp();
        };

        window.handleLessonClick = (lessonId) => {
            state.activeLessonId = lessonId;
            state.isSidebarOpen = false;
            // Scroll top main content not window
            renderApp(); 
            // After render scroll content to top
            const contentArea = document.querySelector('.overflow-y-auto');
            if(contentArea) contentArea.scrollTop = 0;
        };

        window.toggleLessonComplete = (lessonId) => {
            if (state.completedLessons.has(lessonId)) {
                state.completedLessons.delete(lessonId);
            } else {
                state.completedLessons.add(lessonId);
            }
            renderApp();
        };

        window.handleNext = () => {
            const index = getActiveLessonIndex();
            if (index < allLessons.length - 1) {
                const nextLesson = allLessons[index + 1];
                state.activeLessonId = nextLesson.id;
                
                // Switch module if necessary
                const nextModule = courseData.find(m => m.lessons.some(l => l.id === nextLesson.id));
                if (nextModule && nextModule.id !== state.activeModuleId) {
                    state.activeModuleId = nextModule.id;
                }
                renderApp();
            }
        };

        window.handlePrev = () => {
            const index = getActiveLessonIndex();
            if (index > 0) {
                const prevLesson = allLessons[index - 1];
                state.activeLessonId = prevLesson.id;
                
                // Switch module if necessary
                const prevModule = courseData.find(m => m.lessons.some(l => l.id === prevLesson.id));
                if (prevModule && prevModule.id !== state.activeModuleId) {
                    state.activeModuleId = prevModule.id;
                }
                renderApp();
            }
        };

        window.toggleSidebar = () => {
            state.isSidebarOpen = !state.isSidebarOpen;
            renderApp();
        };

        window.handleSearchInput = (val) => {
            state.dashboardSearch = val;
            renderApp();
            // Focus hack to keep input focus after re-render (simple version)
            const input = document.querySelector('input[type="text"]');
            if(input) {
                input.focus();
                // move cursor to end
                const len = input.value.length;
                input.setSelectionRange(len, len);
            }
        };

        // Initial Render
        renderApp();

    </script>
</body>
</html>
